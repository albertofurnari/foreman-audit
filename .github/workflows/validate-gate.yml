name: Validate Gate Packet

on:
  push:
    paths: ['GATES/**']
  pull_request:
    paths: ['GATES/**']

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Basic structure checks
        run: |
          set -euo pipefail
          shopt -s nullglob
          gates=(GATES/*)
          if [ ${#gates[@]} -eq 0 ]; then
            echo "No gates found under GATES/"; exit 1
          fi

          for d in "${gates[@]}"; do
            echo "::group::Checking $d"
            test -f "$d/SUMMARY.yaml"      || { echo "Missing $d/SUMMARY.yaml"; exit 1; }
            test -f "$d/GATE_STATE.json"   || { echo "Missing $d/GATE_STATE.json"; exit 1; }
            test -f "$d/DECISION_LOG.md"   || { echo "Missing $d/DECISION_LOG.md"; exit 1; }
            test -f "$d/RISKS.md"          || { echo "Missing $d/RISKS.md"; exit 1; }
            test -d "$d/EVIDENCE"          || { echo "Missing $d/EVIDENCE/ directory"; exit 1; }
            test -f "$d/CHECKSUMS.txt"     || echo "WARN: $d/CHECKSUMS.txt not present yet (allowed before submission)"
            echo "::endgroup::"
          done

